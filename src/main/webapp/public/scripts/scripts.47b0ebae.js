"use strict";function shoppingCart(a){this.cartName=a,this.clearCart=!1,this.checkoutParameters={},this.items=[],this.loadItems();var b=this;$(window).unload(function(){b.clearCart&&b.clearItems(),b.saveItems(),b.clearCart=!1})}function checkoutParameters(a,b,c){this.serviceName=a,this.merchantID=b,this.options=c}function cartItem(a,b,c,d){this.sku=a,this.name=b,this.price=1*c,this.quantity=1*d}angular.module("quickSilverApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","phonecatServices","phoneFilters"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/shop",{templateUrl:"views/shop.html",controller:"ShopCtrl"}).when("/shop/:phoneId",{templateUrl:"views/phone-detail.html",controller:"PhoneDetailsCtrl"}).when("/cart",{templateUrl:"views/cart.html",controller:"CartCtrl"}).when("/checkout",{templateUrl:"views/checkout.html",controller:"CheckoutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("quickSilverApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("quickSilverApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("quickSilverApp").controller("ShopCtrl",["$scope","Phone",function(a,b){a.phones=b.query(),a.orderProp="age"}]),angular.module("quickSilverApp").controller("CartCtrl",["$scope","dataservice",function(a,b){a.cart=b.cart,console.log(a.cart)}]),angular.module("quickSilverApp").controller("CheckoutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var phonecatServices=angular.module("phonecatServices",["ngResource"]);phonecatServices.factory("Phone",["$resource",function(a){return a("phones/:phoneId.json",{},{query:{method:"GET",params:{phoneId:"phones"},isArray:!0}})}]),angular.module("quickSilverApp").controller("PhoneDetailsCtrl",["$scope","$routeParams","Phone",function(a,b,c){a.phone=c.get({phoneId:b.phoneId},function(b){a.mainImageUrl=b.images[0]}),a.setImage=function(b){a.mainImageUrl=b}}]),angular.module("phoneFilters",[]).filter("checkmark",function(){return function(a){return a?"✓":"✘"}}),angular.module("quickSilverApp").controller("HeaderCtrl",["$scope","$location",function(a,b){a.getClass=function(a){return b.path().substr(0,a.length)===a?"active":void 0}}]),angular.module("quickSilverApp").service("dataservice",function(){var a=new shoppingCart("AngularStore");return a.addItem("2","banane",50,1),{cart:a}}),shoppingCart.prototype.loadItems=function(){var a=null!=localStorage?localStorage[this.cartName+"_items"]:null;if(null!=a&&null!=JSON)try{for(var a=JSON.parse(a),b=0;b<a.length;b++){var c=a[b];null!=c.sku&&null!=c.name&&null!=c.price&&null!=c.quantity&&(c=new cartItem(c.sku,c.name,c.price,c.quantity),this.items.push(c))}}catch(d){}},shoppingCart.prototype.saveItems=function(){null!=localStorage&&null!=JSON&&(localStorage[this.cartName+"_items"]=JSON.stringify(this.items))},shoppingCart.prototype.addItem=function(a,b,c,d){if(d=this.toNumber(d),0!=d){for(var e=!1,f=0;f<this.items.length&&!e;f++){var g=this.items[f];g.sku==a&&(e=!0,g.quantity=this.toNumber(g.quantity+d),g.quantity<=0&&this.items.splice(f,1))}if(!e){var g=new cartItem(a,b,c,d);this.items.push(g)}this.saveItems()}},shoppingCart.prototype.getTotalPrice=function(a){for(var b=0,c=0;c<this.items.length;c++){var d=this.items[c];(null==a||d.sku==a)&&(b+=this.toNumber(d.quantity*d.price))}return b},shoppingCart.prototype.getTotalCount=function(a){for(var b=0,c=0;c<this.items.length;c++){var d=this.items[c];(null==a||d.sku==a)&&(b+=this.toNumber(d.quantity))}return b},shoppingCart.prototype.clearItems=function(){this.items=[],this.saveItems()},shoppingCart.prototype.addCheckoutParameters=function(a,b,c){if("PayPal"!=a&&"Google"!=a)throw"serviceName must be 'PayPal' or 'Google'.";if(null==b)throw"A merchantID is required in order to checkout.";this.checkoutParameters[a]=new checkoutParameters(a,b,c)},shoppingCart.prototype.checkout=function(a,b){if(null==a){var c=this.checkoutParameters[Object.keys(this.checkoutParameters)[0]];a=c.serviceName}if(null==a)throw"Use the 'addCheckoutParameters' method to define at least one checkout service.";var d=this.checkoutParameters[a];if(null==d)throw"Cannot get checkout parameters for '"+a+"'.";switch(d.serviceName){case"PayPal":this.checkoutPayPal(d,b);break;case"Google":this.checkoutGoogle(d,b);break;default:throw"Unknown checkout service: "+d.serviceName}},shoppingCart.prototype.checkoutPayPal=function(a,b){for(var c={cmd:"_cart",business:a.merchantID,upload:"1",rm:"2",charset:"utf-8"},d=0;d<this.items.length;d++){var e=this.items[d],f=d+1;c["item_number_"+f]=e.sku,c["item_name_"+f]=e.name,c["quantity_"+f]=e.quantity,c["amount_"+f]=e.price.toFixed(2)}var g=$("<form/></form>");g.attr("action","https://www.paypal.com/cgi-bin/webscr"),g.attr("method","POST"),g.attr("style","display:none;"),this.addFormFields(g,c),this.addFormFields(g,a.options),$("body").append(g),this.clearCart=null==b||b,g.submit(),g.remove()},shoppingCart.prototype.checkoutGoogle=function(a,b){for(var c={},d=0;d<this.items.length;d++){var e=this.items[d],f=d+1;c["item_name_"+f]=e.sku,c["item_description_"+f]=e.name,c["item_price_"+f]=e.price.toFixed(2),c["item_quantity_"+f]=e.quantity,c["item_merchant_id_"+f]=a.merchantID}var g=$("<form/></form>");g.attr("action","https://sandbox.google.com/checkout/api/checkout/v2/checkoutForm/Merchant/"+a.merchantID),g.attr("method","POST"),g.attr("style","display:none;"),this.addFormFields(g,c),this.addFormFields(g,a.options),$("body").append(g),this.clearCart=null==b||b,g.submit(),g.remove()},shoppingCart.prototype.addFormFields=function(a,b){null!=b&&$.each(b,function(b,c){if(null!=c){var d=$("<input></input>").attr("type","hidden").attr("name",b).val(c);a.append(d)}})},shoppingCart.prototype.toNumber=function(a){return a=1*a,isNaN(a)?0:a};