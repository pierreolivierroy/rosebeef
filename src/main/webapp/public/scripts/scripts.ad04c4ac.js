"use strict";function shoppingCart(a){this.cartName=a,this.clearCart=!1,this.checkoutParameters={},this.items=[],this.loadItems();var b=this;$(window).unload(function(){b.clearCart&&b.clearItems(),b.saveItems(),b.clearCart=!1})}function checkoutParameters(a,b,c){this.serviceName=a,this.merchantID=b,this.options=c}function cartItem(a,b,c,d,e,f){this.id=a,this.sku=b,this.name=c,this.description=d,this.price=1*e,this.quantity=1*f}angular.module("quickSilverApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","phonecatServices","phoneFilters","firebase","angular-loading-bar","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/shop",{templateUrl:"views/shop.html",controller:"ShopCtrl"}).when("/shop/:phoneId",{templateUrl:"views/phone-detail.html",controller:"PhoneDetailsCtrl"}).when("/cart",{templateUrl:"views/cart.html",controller:"CartCtrl"}).when("/checkout",{templateUrl:"views/checkout.html",controller:"CheckoutCtrl"}).when("/order-confirmation",{templateUrl:"views/order-confirmation.html",controller:"OrderConfirmationCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("quickSilverApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("quickSilverApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("quickSilverApp").controller("ShopCtrl",["$scope","Phone",function(a,b){b.getPhones().then(function(b){a.phones=b}),a.orderProp="age"}]),angular.module("quickSilverApp").controller("CartCtrl",["$scope","dataservice",function(a,b){a.cart=b.cart}]),angular.module("quickSilverApp").controller("CheckoutCtrl",["$scope","$http","$location","$rootScope","dataservice","orderconfirmservice","config",function(a,b,c,d,e,f,g){a.cart=e.cart,a.order={},a.errormsg="",a.save=function(b){a.order=angular.copy(b)},a.showModal=function(){a.isOrderValid()&&$("#myModal").modal()},a.isOrderValid=function(){return a.cart.getTotalCount()>0&&null!=a.order.card_firstname&&null!=a.order.card_lastname&&null!=a.order.card_number&&null!=a.order.card_cvv&&null!=a.order.state&&null!=a.order.customer_name&&null!=a.order.email&&null!=a.order.phone&&null!=a.order.city&&null!=a.order.address&&null!=a.order.zip&&null!=a.order.expiry_month&&null!=a.order.expiry_year?!0:(a.errormsg="-1",!1)};var h=function(b,d){c.path(b),a=a||angular.element(document).scope(),(d||!a.$$phase)&&a.$apply()};d.$safeApply=function(a,b){b=b||function(){},a.$$phase?b():a.$apply(b)},a.createOrder=function(){var c=[];angular.forEach(a.cart.items,function(a){var b={id:a.id,name:a.name,quantity:a.quantity,price:a.price,subtotal:a.quantity*a.price};c.push(b)});var d={firstname:a.order.card_firstname,lastname:a.order.card_lastname,email:a.order.email,phone:a.order.phone,city:a.order.city,address:a.order.address,zip:a.order.zip,cardNumber:a.order.card_number,expireMonth:a.order.expiry_month,expireYear:a.order.expiry_year},e={customer:d,amount_no_taxes:a.cart.getSubtotalPrice(),amount_taxes:a.cart.getTPS()+a.cart.getTVQ(),amount_total:a.cart.getTotalPrice(),state:"draft",saleOrderLines:c},i={async:function(){var a=b({method:"POST",url:g.localUrl+"orders",data:e,headers:{"Content-Type":"application/JSON"}}).then(function(a){return a.data});return a}};i.async().then(function(b){console.log(b),0!=b&&"0"!=b&&(f.setConfirmation(b),f.setOrder(e),a.errormsg=b,a.$safeApply(a,function(){a.cart.clearItems(),$("#myModal").modal("hide"),h(g.orderRedirectUrl,!1)}))})}}]).directive("onlyDigits",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&d.$parsers.unshift(function(a){var b=a.split("").filter(function(a){return!isNaN(a)&&" "!=a}).join("");return d.$viewValue=b,d.$render(),b})}}}).directive("postalZipCode",function(){var a=/^(\d{5}(-\d{4})?|[A-Z]\d[A-Z] *\d[A-Z]\d)$/i;return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){e&&e.$parsers.unshift(function(b){var c=a.test(b);return console.log(e.$valid),c||e.$isEmpty(b)})}}});var phonecatServices=angular.module("phonecatServices",["ngResource"]);phonecatServices.factory("Phone",["$http","config",function(a,b){var c={getPhones:function(){var c=a.get(b.localUrl+"products").then(function(a){return a.data});return c},getPhone:function(c){var d=a.get(b.localUrl+"products/"+c).then(function(a){return a.data});return d},getSimilarProducts:function(c){var d=a.get(b.localUrl+"advertising/accessories/"+c).then(function(a){return a.data});return d}};return c}]),angular.module("quickSilverApp").controller("PhoneDetailsCtrl",["$scope","$routeParams","Phone","dataservice","$firebase",function(a,b,c,d,e){var f=new Firebase("https://quicksilver.firebaseio.com/"),g=e(f),h=g.$asArray();a.rate=3,a.max=5,a.isReadonly=!1,a.review_title="",a.review_comment="",a.product_average={value:0},a.ratingStates=[{stateOn:"glyphicon-ok-sign",stateOff:"glyphicon-ok-circle"},{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"},{stateOn:"glyphicon-heart",stateOff:"glyphicon-ban-circle"},{stateOn:"glyphicon-heart"},{stateOff:"glyphicon-off"}],a.cart=d.cart,a.reviews=h,c.getPhone(b.phoneId).then(function(b){a.phone=b,c.getSimilarProducts(a.phone.code).then(function(b){a.ad=b})}),a.addProduct=function(b){null!==a.quantity&&a.cart.addItem(b.id,b.id,b.name,b.description,b.price,a.quantity)},a.add_review=function(){var b=(new Date).valueOf();h.$add({id:b,review_title:a.review_title,product_id:a.phone.id,review_comment:a.review_comment,review_score:a.rate})},a.hoveringOver=function(b){a.overStar=b,a.percent=100*(b/a.max)},a.getTimes=function(a){return new Array(a)};var i=function(){for(var b=0,c=0;c<h.length;c++)h[c].product_id==a.phone.id&&(b+=h[c].review_score);a.product_average.value=Math.floor(b/h.length)};h.$loaded().then(function(){i()})}]),angular.module("phoneFilters",[]).filter("checkmark",function(){return function(a){return a?"✓":"✘"}}),angular.module("quickSilverApp").controller("HeaderCtrl",["$scope","$location","dataservice",function(a,b,c){a.cart=c.cart,a.getClass=function(a){return b.path().substr(0,a.length)===a?"active":void 0}}]),angular.module("quickSilverApp").service("dataservice",function(){var a=new shoppingCart("AngularStore");return{cart:a}});var TPS_CONST=.05,TVQ_CONST=.09975;shoppingCart.prototype.loadItems=function(){var a=null!=localStorage?localStorage[this.cartName+"_items"]:null;if(null!=a&&null!=JSON)try{for(var a=JSON.parse(a),b=0;b<a.length;b++){var c=a[b];null!=c.id&&null!=c.sku&&null!=c.name&&null!=c.description&&null!=c.price&&null!=c.quantity&&(c=new cartItem(c.id,c.sku,c.name,c.description,c.price,c.quantity),this.items.push(c))}}catch(d){}},shoppingCart.prototype.saveItems=function(){null!=localStorage&&null!=JSON&&(localStorage[this.cartName+"_items"]=JSON.stringify(this.items))},shoppingCart.prototype.addItem=function(a,b,c,d,e,f){if(f=this.toNumber(f),0!=f){for(var g=!1,h=0;h<this.items.length&&!g;h++){var i=this.items[h];i.id==a&&(g=!0,i.quantity=this.toNumber(i.quantity+f),i.quantity<=0&&this.items.splice(h,1))}if(!g){console.log("not found");var i=new cartItem(a,b,c,d,e,f);this.items.push(i)}this.saveItems()}},shoppingCart.prototype.getItemSubtotal=function(a){return a.quantity*a.price},shoppingCart.prototype.getSubtotalPrice=function(a){for(var b=0,c=0;c<this.items.length;c++){var d=this.items[c];(null==a||d.sku==a)&&(b+=this.toNumber(d.quantity*d.price))}return b},shoppingCart.prototype.getTPS=function(){return this.getSubtotalPrice()*TPS_CONST},shoppingCart.prototype.getTVQ=function(){return this.getSubtotalPrice()*TVQ_CONST},shoppingCart.prototype.getTotalPrice=function(){return this.getSubtotalPrice()+this.getTPS()+this.getTVQ()},shoppingCart.prototype.getTotalCount=function(a){for(var b=0,c=0;c<this.items.length;c++){var d=this.items[c];(null==a||d.sku==a)&&(b+=this.toNumber(d.quantity))}return b},shoppingCart.prototype.clearItem=function(a){var b=this.items.indexOf(a);-1!==b&&this.items.splice(b,1),this.saveItems()},shoppingCart.prototype.clearItems=function(){this.items=[],this.saveItems()},shoppingCart.prototype.addCheckoutParameters=function(a,b,c){if("PayPal"!=a&&"Google"!=a)throw"serviceName must be 'PayPal' or 'Google'.";if(null==b)throw"A merchantID is required in order to checkout.";this.checkoutParameters[a]=new checkoutParameters(a,b,c)},shoppingCart.prototype.checkout=function(a,b){if(null==a){var c=this.checkoutParameters[Object.keys(this.checkoutParameters)[0]];a=c.serviceName}if(null==a)throw"Use the 'addCheckoutParameters' method to define at least one checkout service.";var d=this.checkoutParameters[a];if(null==d)throw"Cannot get checkout parameters for '"+a+"'.";switch(d.serviceName){case"PayPal":this.checkoutPayPal(d,b);break;case"Google":this.checkoutGoogle(d,b);break;default:throw"Unknown checkout service: "+d.serviceName}},shoppingCart.prototype.checkoutPayPal=function(a,b){for(var c={cmd:"_cart",business:a.merchantID,upload:"1",rm:"2",charset:"utf-8"},d=0;d<this.items.length;d++){var e=this.items[d],f=d+1;c["item_number_"+f]=e.sku,c["item_name_"+f]=e.name,c["quantity_"+f]=e.quantity,c["amount_"+f]=e.price.toFixed(2)}var g=$("<form/></form>");g.attr("action","https://www.paypal.com/cgi-bin/webscr"),g.attr("method","POST"),g.attr("style","display:none;"),this.addFormFields(g,c),this.addFormFields(g,a.options),$("body").append(g),this.clearCart=null==b||b,g.submit(),g.remove()},shoppingCart.prototype.checkoutGoogle=function(a,b){for(var c={},d=0;d<this.items.length;d++){var e=this.items[d],f=d+1;c["item_name_"+f]=e.sku,c["item_description_"+f]=e.name,c["item_price_"+f]=e.price.toFixed(2),c["item_quantity_"+f]=e.quantity,c["item_merchant_id_"+f]=a.merchantID}var g=$("<form/></form>");g.attr("action","https://sandbox.google.com/checkout/api/checkout/v2/checkoutForm/Merchant/"+a.merchantID),g.attr("method","POST"),g.attr("style","display:none;"),this.addFormFields(g,c),this.addFormFields(g,a.options),$("body").append(g),this.clearCart=null==b||b,g.submit(),g.remove()},shoppingCart.prototype.addFormFields=function(a,b){null!=b&&$.each(b,function(b,c){if(null!=c){var d=$("<input></input>").attr("type","hidden").attr("name",b).val(c);a.append(d)}})},shoppingCart.prototype.toNumber=function(a){return a=1*a,isNaN(a)?0:a},angular.module("quickSilverApp").controller("OrderConfirmationCtrl",["$scope","orderconfirmservice",function(a,b){$(".modal-backdrop").remove(),a.confirmation=b.getConfirmation(),a.order=b.getOrder(),a.date=new Date}]),angular.module("quickSilverApp").service("orderconfirmservice",function(){var a,b=[],c=function(a){b=a},d=function(){return b},e=function(b){a=b},f=function(){return a};return{setConfirmation:c,getConfirmation:d,setOrder:e,getOrder:f}}),angular.module("quickSilverApp").constant("config",{localUrl:"http://localhost:8080/",baseUrl:"",orderRedirectUrl:"/order-confirmation"});